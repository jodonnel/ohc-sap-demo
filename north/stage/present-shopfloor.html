<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shop-Floor Visual Inspection ‚Üí SAP QM</title>
<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;400;700;900&family=Red+Hat+Mono:wght@400;700&family=Red+Hat+Text:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #06090F; --surface: #0D1117; --border: #1C2333; --muted: #4E5D6C; --text: #F0F4F8;
  --green: #00D26A; --blue: #0070F2; --red: #EE0000;
  --red-glow: rgba(238,0,0,0.10);
  --amber: #F59E0B; --teal: #14B8A6;
}
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; overflow:hidden; background:var(--bg); color:var(--text); font-family:'Red Hat Display',sans-serif; }

.deck { position:relative; width:100vw; height:100vh; }
.slide {
  position:absolute; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center; padding:60px 80px;
  opacity:0; pointer-events:none; transition:opacity 0.5s ease;
}
.slide.active { opacity:1; pointer-events:auto; }

/* Live pip */
.live-pip {
  position:fixed; bottom:24px; right:32px; z-index:100;
  background:var(--surface); border:1px solid var(--border); border-radius:12px;
  padding:10px 18px; display:flex; align-items:center; gap:12px;
  opacity:0; transition:opacity 0.4s;
}
.live-pip.visible { opacity:1; }
.live-pip .dot { width:8px; height:8px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
.live-pip .count { font-family:'Red Hat Mono',monospace; font-size:16px; font-weight:700; color:var(--red); font-variant-numeric:tabular-nums; }
.live-pip .label { font-size:11px; color:var(--muted); }

/* Back link */
.back-link {
  position:fixed; top:20px; left:32px; z-index:200;
  color:var(--muted); font-size:12px; font-family:'Red Hat Mono',monospace;
  text-decoration:none; letter-spacing:1px;
  transition:color 0.2s;
}
.back-link:hover { color:var(--text); }

/* Progress */
.progress { position:fixed; top:0; left:0; height:3px; z-index:200; background:linear-gradient(90deg,var(--red),var(--blue)); transition:width 0.3s; }
.slide-num { position:fixed; bottom:24px; left:50%; transform:translateX(-50%); z-index:100; font-family:'Red Hat Mono',monospace; font-size:12px; color:var(--muted); display:flex; align-items:center; gap:16px; } .nav-btn { background:none; border:1px solid var(--border,#253040); border-radius:4px; color:var(--muted,#8B98A5); font-family:'Red Hat Mono',monospace; font-size:13px; padding:6px 14px; cursor:pointer; transition:border-color 0.15s,color 0.15s; } .nav-btn:hover { border-color:var(--text,#E8EDF2); color:var(--text,#E8EDF2); } .nav-btn:disabled { opacity:0.2; cursor:default; }

/* Typography */
.mega { font-size:clamp(3rem,8vw,6rem); font-weight:900; line-height:1.05; }
.big { font-size:clamp(2rem,5vw,3.5rem); font-weight:700; line-height:1.15; }
.medium { font-size:clamp(1.2rem,3vw,1.8rem); font-weight:300; line-height:1.4; font-family:'Red Hat Text',sans-serif; }
.small { font-size:14px; color:var(--muted); font-family:'Red Hat Text',sans-serif; }
.mono { font-family:'Red Hat Mono',monospace; }
.red { color:var(--red); } .blue { color:var(--blue); } .green { color:var(--green); }
.muted { color:var(--muted); } .center { text-align:center; }

.brand { display:flex; align-items:center; gap:20px; margin-bottom:32px; }
.brand .rh { color:var(--red); font-size:14px; font-weight:700; letter-spacing:2px; }
.brand .sep { color:var(--muted); font-size:20px; }
.brand .sap { color:var(--blue); font-size:14px; font-weight:700; letter-spacing:2px; }

.spacer { height:24px; } .spacer-lg { height:48px; }

/* Stats */
.stat-row { display:flex; gap:40px; margin-top:32px; flex-wrap:wrap; justify-content:center; }
.stat { text-align:center; }
.stat-val { font-family:'Red Hat Mono',monospace; font-size:clamp(2rem,5vw,3rem); font-weight:700; }
.stat-val.red { color:var(--red); }
.stat-val.green { color:var(--green); }
.stat-val.blue { color:var(--blue); }
.stat-label { font-size:11px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; margin-top:4px; }
.stat-sub { font-size:12px; color:var(--muted); font-family:'Red Hat Text',sans-serif; margin-top:2px; }

/* Points */
.points { list-style:none; margin-top:24px; width:100%; max-width:900px; }
.points li { font-size:18px; font-weight:300; padding:10px 0; border-bottom:1px solid var(--border); display:flex; align-items:flex-start; gap:12px; font-family:'Red Hat Text',sans-serif; }
.points li .icon { font-size:22px; flex-shrink:0; margin-top:1px; }

/* Flow diagram */
.flow { display:flex; align-items:center; gap:0; margin-top:32px; flex-wrap:wrap; justify-content:center; width:100%; max-width:960px; }
.flow-node {
  display:flex; flex-direction:column; align-items:center; gap:8px;
  background:var(--surface); border:1px solid var(--border); border-radius:14px;
  padding:20px 24px; min-width:180px; text-align:center;
}
.flow-node .node-icon { font-size:2rem; }
.flow-node .node-title { font-size:13px; font-weight:700; letter-spacing:0.5px; }
.flow-node .node-sub { font-size:11px; color:var(--muted); font-family:'Red Hat Mono',monospace; margin-top:2px; }
.flow-arrow {
  font-size:1.4rem; color:var(--red); padding:0 8px; flex-shrink:0;
}
.flow-node.highlight { border-color:var(--red); box-shadow:0 0 20px var(--red-glow); }

/* Trigger zone */
.trigger-zone {
  width:100%; max-width:760px; background:var(--surface);
  border:1px solid var(--border); border-radius:16px; padding:32px; margin-top:20px;
}
.trigger-zone h3 { font-size:13px; font-weight:700; color:var(--muted); letter-spacing:1.5px; text-transform:uppercase; margin-bottom:16px; }

.btn-group { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
.tog-btn {
  background:transparent; border:1px solid var(--border); border-radius:8px;
  color:var(--muted); font-family:'Red Hat Mono',monospace; font-size:13px;
  padding:8px 18px; cursor:pointer; transition:all 0.15s;
}
.tog-btn:hover { border-color:var(--text); color:var(--text); }
.tog-btn.active { border-color:var(--red); color:var(--text); background:rgba(238,0,0,0.08); }
.tog-btn.active.sev-minor { border-color:var(--amber); color:var(--amber); background:rgba(245,158,11,0.08); }
.tog-btn.active.sev-major { border-color:var(--blue); color:var(--blue); background:rgba(0,112,242,0.08); }
.tog-btn.active.sev-critical { border-color:var(--red); color:var(--red); background:rgba(238,0,0,0.12); }

.payload-preview {
  background:var(--bg); border:1px solid var(--border); border-radius:8px;
  padding:14px 18px; margin-bottom:20px;
  font-family:'Red Hat Mono',monospace; font-size:12px; color:var(--muted); line-height:1.7;
}
.payload-preview .key { color:var(--blue); }
.payload-preview .val { color:var(--green); }
.payload-preview .val.red { color:var(--red); }
.payload-preview .val.amber { color:var(--amber); }

.fire-btn {
  background:var(--red); color:#fff; border:none; border-radius:10px;
  font-family:'Red Hat Display',sans-serif; font-size:18px; font-weight:700;
  padding:14px 36px; cursor:pointer; transition:all 0.15s;
  letter-spacing:0.5px;
}
.fire-btn:hover { background:#cc0000; transform:scale(1.02); }
.fire-btn:active { transform:scale(0.98); }
.fire-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

.result-box {
  margin-top:18px; background:var(--bg); border:1px solid var(--border); border-radius:10px;
  padding:16px 20px; font-family:'Red Hat Mono',monospace; font-size:13px; line-height:1.8;
  display:none;
}
.result-box.visible { display:block; }
.result-box.success { border-color:var(--green); }
.result-box.error-state { border-color:var(--red); }
.result-box .res-key { color:var(--muted); }
.result-box .res-val { color:var(--green); font-weight:700; }
.result-box .res-lot { color:var(--text); font-weight:700; font-size:15px; }

/* Subtle ambient glow */
.glow-bg::before {
  content:''; position:absolute; top:40%; left:50%; width:800px; height:800px;
  transform:translate(-50%,-50%);
  background:radial-gradient(circle,var(--red-glow) 0%,transparent 70%);
  pointer-events:none; z-index:-1;
}

@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
@keyframes fadeUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
.fade-up { animation:fadeUp 0.6s ease-out both; }
.delay-1 { animation-delay:0.15s; } .delay-2 { animation-delay:0.3s; }
.delay-3 { animation-delay:0.45s; } .delay-4 { animation-delay:0.6s; }
.delay-5 { animation-delay:0.75s; }

/* Mobile */
@media (max-width:768px) {
  .slide { padding:24px 20px; }
  .mega { font-size:clamp(2rem,10vw,3.5rem); }
  .big { font-size:clamp(1.4rem,6vw,2.2rem); }
  .medium { font-size:clamp(1rem,4vw,1.3rem); }
  .stat-row { gap:16px; }
  .stat-val { font-size:1.5rem; }
  .flow { gap:0; }
  .flow-node { min-width:120px; padding:14px 12px; }
  .flow-arrow { font-size:1rem; padding:0 2px; }
  .trigger-zone { padding:16px; }
  .live-pip { bottom:10px; right:10px; padding:6px 10px; }
  .back-link { top:10px; left:10px; }
  .slide-num { bottom:10px; font-size:10px; }
  .points li { font-size:14px; padding:8px 0; }
}
</style>
</head>
<body>

<div class="progress" id="progress"></div>
<div class="slide-num"><button class="nav-btn" id="prevBtn" onclick="if(current>1)showSlide(--current)">‚Üê</button><span id="slideNum"></span><button class="nav-btn" id="nextBtn" onclick="if(current<total)showSlide(++current)">‚Üí</button><a href="/present-index" class="nav-btn" style="text-decoration:none;">‚åÇ</a></div>
<a href="/present-index" class="back-link">&#8592; INDEX</a>

<div class="live-pip" id="livePip">
  <div class="dot"></div>
  <span class="count" id="pipCount">0</span>
  <span class="label">detections</span>
</div>

<div class="deck" id="deck">

  <!-- SLIDE 1: HOOK -->
  <div class="slide active glow-bg" data-slide="1">
    <div class="brand fade-up">
      <span class="rh">RED HAT</span><span class="sep">√ó</span><span class="sap">SAP</span>
    </div>
    <div class="mega center fade-up delay-1">
      Camera sees defect.<br>
      SAP creates inspection lot.<br>
      <span class="red">Under 500ms.</span>
    </div>
    <div class="spacer"></div>
    <div class="medium center muted fade-up delay-2">
      Edge AI inference on Red Hat OpenShift AI &middot; GPU-accelerated
    </div>
  </div>

  <!-- SLIDE 2: THE PROBLEM -->
  <div class="slide" data-slide="2">
    <div class="big center fade-up">
      Manual inspection is a bottleneck.<br><span class="red">And a liability.</span>
    </div>
    <div class="spacer-lg"></div>
    <ul class="points">
      <li class="fade-up delay-1">
        <span class="icon">üì∑</span>
        <span>A camera on the production line captures every part ‚Äî thousands per shift</span>
      </li>
      <li class="fade-up delay-2">
        <span class="icon">üìù</span>
        <span>Today: humans inspect, mark defects on paper, log manually into SAP QM ‚Äî hours later</span>
      </li>
      <li class="fade-up delay-3">
        <span class="icon">üì¶</span>
        <span>Defective parts ship. Returns happen. Audits fail.</span>
      </li>
      <li class="fade-up delay-4">
        <span class="icon">üîå</span>
        <span>The data exists. The connection doesn't.</span>
      </li>
    </ul>
  </div>

  <!-- SLIDE 3: THE ARCHITECTURE -->
  <div class="slide" data-slide="3">
    <div class="big center fade-up">
      Camera &rarr; AI &rarr; EIC &rarr; SAP QM. <span class="red">Automated.</span>
    </div>
    <div class="flow fade-up delay-1">
      <div class="flow-node">
        <div class="node-icon">üì∑</div>
        <div class="node-title">Production Camera</div>
        <div class="node-sub">Raw image stream</div>
      </div>
      <div class="flow-arrow">‚Üí</div>
      <div class="flow-node highlight">
        <div class="node-icon">üß†</div>
        <div class="node-title">OpenShift AI Edge Node</div>
        <div class="node-sub">Defect classifier (RTX 3070)</div>
      </div>
      <div class="flow-arrow">‚Üí</div>
      <div class="flow-node">
        <div class="node-icon">üîÑ</div>
        <div class="node-title">EIC on OpenShift</div>
        <div class="node-sub">ohc.demo.shopfloor<br>.defect_detected</div>
      </div>
      <div class="flow-arrow">‚Üí</div>
      <div class="flow-node">
        <div class="node-icon">‚úÖ</div>
        <div class="node-title">SAP QM</div>
        <div class="node-sub">Inspection lot created,<br>line halted if critical</div>
      </div>
    </div>
    <div class="spacer"></div>
    <div class="small center fade-up delay-2">
      487ms end-to-end &nbsp;&middot;&nbsp; GPU-accelerated inference at the edge &nbsp;&middot;&nbsp; No cloud round-trip.
    </div>
  </div>

  <!-- SLIDE 4: FIRE THE EVENT -->
  <div class="slide" data-slide="4">
    <div class="big center fade-up">Trigger a defect detection.</div>
    <div class="medium center muted fade-up delay-1">Simulate a camera event &rarr; SAP QM inspection lot.</div>
    <div class="trigger-zone fade-up delay-2">

      <h3>Severity</h3>
      <div class="btn-group" id="sevGroup">
        <button class="tog-btn sev-minor" data-sev="minor" onclick="setSev(this)">Minor</button>
        <button class="tog-btn sev-major active" data-sev="major" onclick="setSev(this)">Major</button>
        <button class="tog-btn sev-critical" data-sev="critical" onclick="setSev(this)">Critical</button>
      </div>

      <h3>Defect Type</h3>
      <div class="btn-group" id="typeGroup">
        <button class="tog-btn active" data-type="surface_scratch" onclick="setType(this)">surface_scratch</button>
        <button class="tog-btn" data-type="dimension_out_of_spec" onclick="setType(this)">dimension_out_of_spec</button>
        <button class="tog-btn" data-type="weld_failure" onclick="setType(this)">weld_failure</button>
      </div>

      <div class="payload-preview" id="payloadPreview">
        <span class="key">{</span><br>
        &nbsp;&nbsp;<span class="key">"defect_type"</span>: <span class="val" id="pvType">"surface_scratch"</span>,<br>
        &nbsp;&nbsp;<span class="key">"severity"</span>: <span class="val amber" id="pvSev">"major"</span>,<br>
        &nbsp;&nbsp;<span class="key">"part_number"</span>: <span class="val">"PN-00442"</span>,<br>
        &nbsp;&nbsp;<span class="key">"line_id"</span>: <span class="val">"LINE-A3"</span><br>
        <span class="key">}</span>
      </div>

      <button class="fire-btn" id="fireBtn" onclick="fireDefect()">üîç Detect Defect</button>

      <div class="result-box" id="resultBox">
        <span class="res-key">inspection_lot: </span><span class="res-lot" id="resLot">‚Äî</span><br>
        <span class="res-key">latency_ms: </span><span class="res-val" id="resLatency">‚Äî</span><br>
        <span class="res-key">status: </span><span class="res-val" id="resStatus">‚Äî</span>
      </div>
    </div>
  </div>

  <!-- SLIDE 5: THE NUMBERS -->
  <div class="slide glow-bg" data-slide="5">
    <div class="stat-row fade-up">
      <div class="stat">
        <div class="stat-val red">&lt; 500ms</div>
        <div class="stat-label">End-to-end latency</div>
        <div class="stat-sub">stub: 487ms</div>
      </div>
      <div class="stat">
        <div class="stat-val green">94%</div>
        <div class="stat-label">Model confidence</div>
        <div class="stat-sub">defect-classifier-v2</div>
      </div>
      <div class="stat">
        <div class="stat-val blue">0</div>
        <div class="stat-label">Cloud round-trips</div>
        <div class="stat-sub">all inference at edge</div>
      </div>
    </div>
    <div class="spacer-lg"></div>
    <div class="big center fade-up delay-2">
      The GPU that renders your games<br>detects manufacturing defects between shifts.
    </div>
  </div>

  <!-- SLIDE 6: CLOSE -->
  <div class="slide glow-bg" data-slide="6">
    <div class="mega center fade-up">
      Every defect caught at the line<br>is a return prevented.
    </div>
    <div class="spacer-lg"></div>
    <div class="medium center red fade-up delay-2">
      The same OpenShift AI node that runs vision inspection<br>runs the 3D-GRC anomaly detector.
    </div>
    <div class="spacer"></div>
    <div class="small center fade-up delay-3">One platform. Every use case.</div>
  </div>

</div>

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedSev  = 'major';
let selectedType = 'surface_scratch';
let detectionCount = 0;

// ‚îÄ‚îÄ Selector helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setSev(btn) {
  document.querySelectorAll('#sevGroup .tog-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedSev = btn.dataset.sev;
  updatePayloadPreview();
}

function setType(btn) {
  document.querySelectorAll('#typeGroup .tog-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedType = btn.dataset.type;
  updatePayloadPreview();
}

function updatePayloadPreview() {
  const pvType = document.getElementById('pvType');
  const pvSev  = document.getElementById('pvSev');
  if (pvType) pvType.textContent = '"' + selectedType + '"';
  if (pvSev) {
    pvSev.textContent = '"' + selectedSev + '"';
    pvSev.className = 'val ' + (selectedSev === 'critical' ? 'red' : selectedSev === 'minor' ? '' : 'amber');
    if (selectedSev === 'minor') pvSev.style.color = 'var(--green)';
    else pvSev.style.color = '';
  }
}

// ‚îÄ‚îÄ Fire defect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fireDefect() {
  const btn    = document.getElementById('fireBtn');
  const result = document.getElementById('resultBox');
  btn.disabled = true;
  btn.textContent = 'Detecting‚Ä¶';
  result.classList.remove('visible', 'success', 'error-state');

  const payload = {
    defect_type: selectedType,
    severity:    selectedSev,
    part_number: 'PN-00442',
    line_id:     'LINE-A3'
  };

  const t0 = performance.now();

  fetch('/shopfloor/defect', {
    method:  'POST',
    headers: { 'Content-Type': 'application/json' },
    body:    JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(d => {
    const ms = d.latency_ms || Math.round(performance.now() - t0);
    showResult(d.inspection_lot || ('IL-' + String(Date.now()).slice(-6)), ms, 'created');
    detectionCount++;
    document.getElementById('pipCount').textContent = detectionCount;
  })
  .catch(() => {
    // Stub fallback ‚Äî demo mode when backend is unavailable
    const ms    = 487 + Math.floor(Math.random() * 40 - 20);
    const lotId = 'IL-' + String(Date.now()).slice(-6);
    showResult(lotId, ms, 'created (stub)');
    detectionCount++;
    document.getElementById('pipCount').textContent = detectionCount;
  })
  .finally(() => {
    btn.disabled = false;
    btn.textContent = 'üîç Detect Defect';
  });
}

function showResult(lot, ms, status) {
  document.getElementById('resLot').textContent     = lot;
  document.getElementById('resLatency').textContent = ms + 'ms';
  document.getElementById('resStatus').textContent  = status;
  const box = document.getElementById('resultBox');
  box.classList.add('visible', 'success');
}

// ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const slides     = document.querySelectorAll('.slide');
const totalSlides = slides.length;
let current = 0;

const progressEl = document.getElementById('progress');
const slideNumEl = document.getElementById('slideNum');
const livePip    = document.getElementById('livePip');

function goTo(n) {
  if (n < 0 || n >= totalSlides) return;
  slides[current].classList.remove('active');
  current = n;
  slides[current].classList.add('active');
  progressEl.style.width = ((current + 1) / totalSlides * 100) + '%';
  slideNumEl.textContent = (current + 1) + ' / ' + totalSlides;
  livePip.classList.toggle('visible', current >= 3);

  // Announce slide change to server (best-effort)
  fetch('/ingest', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      specversion: '1.0', type: 'presenter.slide_change',
      source: 'present-shopfloor',
      data: { slide: current + 1, total: totalSlides }
    })
  }).catch(() => {});
}

function next() { goTo(current + 1); }
function prev() { goTo(current - 1); }

// Keyboard
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'PageDown') { e.preventDefault(); next(); }
  if (e.key === 'ArrowLeft'  || e.key === 'PageUp')                   { e.preventDefault(); prev(); }
  if (e.key === 'Home') { e.preventDefault(); goTo(0); }
  if (e.key === 'End')  { e.preventDefault(); goTo(totalSlides - 1); }
  if (e.key === 'f' || e.key === 'F') {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  }
});

// Touch swipe
let touchStartX = 0, touchStartY = 0;
document.addEventListener('touchstart', e => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, { passive: true });
document.addEventListener('touchend', e => {
  const dx = touchStartX - e.changedTouches[0].clientX;
  const dy = touchStartY - e.changedTouches[0].clientY;
  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
    dx > 0 ? next() : prev();
  }
}, { passive: true });

// Click (left 20% = back, rest = forward; skip interactive elements)
document.addEventListener('click', e => {
  if (e.target.closest('a,button,.tog-btn,.fire-btn,.result-box,.trigger-zone,.payload-preview')) return;
  if (e.clientX < window.innerWidth * 0.2) prev();
  else next();
});

// Init
goTo(0);
</script>
</body>
</html>
