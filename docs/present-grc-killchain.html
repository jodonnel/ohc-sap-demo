<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D-GRC Kill Chain — OHC Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@300;400;700;900&family=Red+Hat+Mono:wght@400;700&family=Red+Hat+Text:wght@300;400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #06090F; --surface: #0D1117; --border: #1C2333; --muted: #4E5D6C; --text: #F0F4F8;
  --green: #00D26A; --blue: #0070F2; --red: #EE0000;
  --red-glow: rgba(238,0,0,0.10);
  --amber: #F59E0B; --teal: #14B8A6;
}
* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; overflow:hidden; background:var(--bg); color:var(--text); font-family:'Red Hat Display',sans-serif; }

.deck { position:relative; width:100vw; height:100vh; }
.slide {
  position:absolute; inset:0; display:flex; flex-direction:column;
  align-items:center; justify-content:center; padding:60px 80px;
  opacity:0; pointer-events:none; transition:opacity 0.5s ease;
}
.slide.active { opacity:1; pointer-events:auto; }

/* Live pip */
.live-pip {
  position:fixed; bottom:24px; right:32px; z-index:100;
  background:var(--surface); border:1px solid var(--border); border-radius:12px;
  padding:10px 18px; display:flex; align-items:center; gap:12px;
  opacity:0; transition:opacity 0.4s;
}
.live-pip.visible { opacity:1; }
.live-pip .dot { width:8px; height:8px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
.live-pip .count { font-family:'Red Hat Mono',monospace; font-size:16px; font-weight:700; color:var(--red); font-variant-numeric:tabular-nums; }
.live-pip .label { font-size:11px; color:var(--muted); }

/* Progress */
.progress { position:fixed; top:0; left:0; height:3px; z-index:200; background:linear-gradient(90deg,var(--red),var(--blue)); transition:width 0.3s; }
.slide-num { position:fixed; bottom:24px; left:50%; transform:translateX(-50%); z-index:100; font-family:'Red Hat Mono',monospace; font-size:12px; color:var(--muted); display:flex; align-items:center; gap:16px; } .nav-btn { background:none; border:1px solid var(--border,#253040); border-radius:4px; color:var(--muted,#8B98A5); font-family:'Red Hat Mono',monospace; font-size:13px; padding:6px 14px; cursor:pointer; transition:border-color 0.15s,color 0.15s; } .nav-btn:hover { border-color:var(--text,#E8EDF2); color:var(--text,#E8EDF2); } .nav-btn:disabled { opacity:0.2; cursor:default; }

/* Back link */
.back-link { position:fixed; top:20px; left:28px; z-index:200; font-size:12px; color:var(--muted); text-decoration:none; font-family:'Red Hat Mono',monospace; }
.back-link:hover { color:var(--text); }

/* Typography */
.mega { font-size:clamp(3rem,8vw,6rem); font-weight:900; line-height:1.05; }
.big { font-size:clamp(2rem,5vw,3.5rem); font-weight:700; line-height:1.15; }
.medium { font-size:clamp(1.2rem,3vw,1.8rem); font-weight:300; line-height:1.4; font-family:'Red Hat Text',sans-serif; }
.small { font-size:14px; color:var(--muted); font-family:'Red Hat Text',sans-serif; }
.mono { font-family:'Red Hat Mono',monospace; }
.red { color:var(--red); } .blue { color:var(--blue); } .green-c { color:var(--green); }
.amber { color:var(--amber); } .muted { color:var(--muted); } .center { text-align:center; }

.brand { display:flex; align-items:center; gap:20px; margin-bottom:32px; }
.brand .rh { color:var(--red); font-size:14px; font-weight:700; letter-spacing:2px; text-transform:uppercase; }
.brand .sep { color:var(--muted); font-size:20px; }
.brand .sap { color:var(--blue); font-size:14px; font-weight:700; letter-spacing:2px; text-transform:uppercase; }

.spacer { height:24px; } .spacer-lg { height:48px; }

/* Points */
.points { list-style:none; margin-top:24px; width:100%; max-width:820px; }
.points li {
  font-size:clamp(14px,2vw,18px); font-weight:300; padding:12px 0;
  border-bottom:1px solid var(--border); display:flex; align-items:flex-start; gap:14px;
  font-family:'Red Hat Text',sans-serif; line-height:1.5;
}
.points li .icon { font-size:22px; flex-shrink:0; margin-top:1px; }
.points li strong { color:var(--text); font-weight:700; }

/* Kill chain flow */
.chain-flow {
  display:flex; align-items:center; gap:0; width:100%; max-width:980px;
  margin-top:32px;
}
.chain-node {
  flex:1; background:rgba(238,0,0,0.08); border:1px solid rgba(238,0,0,0.35);
  border-radius:14px; padding:24px 20px; text-align:center;
  position:relative;
}
.chain-node .node-icon { font-size:2.4rem; margin-bottom:10px; display:block; }
.chain-node .node-label {
  font-size:clamp(11px,1.4vw,14px); font-weight:700; color:var(--red);
  letter-spacing:1px; text-transform:uppercase; margin-bottom:8px;
}
.chain-node .node-desc {
  font-size:clamp(11px,1.3vw,13px); color:var(--muted);
  font-family:'Red Hat Text',sans-serif; line-height:1.4;
}
.chain-arrow {
  font-size:2rem; color:var(--red); flex-shrink:0; padding:0 16px;
  font-weight:900; opacity:0.7;
}
.chain-subtitle {
  margin-top:28px; font-size:clamp(13px,1.8vw,16px); color:var(--muted);
  font-family:'Red Hat Text',sans-serif; text-align:center; max-width:700px;
}

/* Glow bg */
.glow-bg::before {
  content:''; position:absolute; top:40%; left:50%; width:800px; height:800px;
  transform:translate(-50%,-50%);
  background:radial-gradient(circle,var(--red-glow) 0%,transparent 70%);
  pointer-events:none; z-index:-1;
}

/* Fire scenario slide */
.scenario-box {
  width:100%; max-width:820px; background:var(--surface);
  border:1px solid var(--border); border-radius:18px; padding:36px 40px;
  margin-top:24px;
}
.phase-track {
  display:flex; align-items:center; gap:0; margin-bottom:32px; justify-content:center;
}
.phase-item {
  display:flex; align-items:center; gap:10px;
  font-family:'Red Hat Mono',monospace; font-size:clamp(11px,1.4vw,14px);
}
.phase-dot {
  width:14px; height:14px; border-radius:50%;
  background:var(--border); border:2px solid var(--muted);
  transition:background 0.4s, border-color 0.4s, box-shadow 0.4s;
  flex-shrink:0;
}
.phase-dot.fired {
  background:var(--green); border-color:var(--green);
  box-shadow:0 0 10px rgba(0,210,106,0.5);
}
.phase-arrow { color:var(--muted); padding:0 14px; font-size:1.1rem; flex-shrink:0; }
.phase-label { color:var(--muted); transition:color 0.4s; }
.phase-item.fired .phase-label { color:var(--green); }

.delay-row {
  display:flex; align-items:center; gap:12px; margin-bottom:24px;
  font-family:'Red Hat Mono',monospace; font-size:13px; color:var(--muted);
}
.delay-btn {
  background:var(--surface); border:1px solid var(--border);
  color:var(--muted); font-family:'Red Hat Mono',monospace;
  font-size:13px; padding:6px 14px; border-radius:6px; cursor:pointer;
  transition:border-color 0.2s, color 0.2s;
}
.delay-btn:hover { border-color:var(--muted); color:var(--text); }
.delay-btn.selected { border-color:var(--red); color:var(--red); background:rgba(238,0,0,0.08); }

.fire-btn {
  display:block; width:100%; padding:18px 32px;
  background:var(--red); color:#fff;
  border:none; border-radius:12px; cursor:pointer;
  font-family:'Red Hat Display',sans-serif; font-size:clamp(16px,2.2vw,22px);
  font-weight:700; letter-spacing:1px;
  transition:opacity 0.2s, transform 0.1s;
}
.fire-btn:hover { opacity:0.88; }
.fire-btn:active { transform:scale(0.98); }
.fire-btn:disabled { opacity:0.4; cursor:not-allowed; }

.status-line {
  margin-top:18px; font-family:'Red Hat Mono',monospace;
  font-size:13px; color:var(--muted); min-height:20px; text-align:center;
  transition:color 0.3s;
}
.status-line.active-status { color:var(--amber); }
.status-line.done-status { color:var(--green); }

/* Close slide */
.accent-rule {
  width:100%; max-width:600px; height:3px;
  background:linear-gradient(90deg,var(--red),var(--blue));
  border-radius:2px; margin:28px auto;
}
.close-sub {
  font-size:clamp(1rem,2.2vw,1.4rem); color:var(--muted);
  font-family:'Red Hat Text',sans-serif; font-weight:300;
  text-align:center; margin-top:16px;
}

/* Animations */
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
@keyframes fadeUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
.fade-up { animation:fadeUp 0.6s ease-out both; }
.delay-1 { animation-delay:0.15s; } .delay-2 { animation-delay:0.3s; }
.delay-3 { animation-delay:0.45s; } .delay-4 { animation-delay:0.6s; }

/* Mobile */
@media (max-width:768px) {
  .slide { padding:24px 20px; }
  .mega { font-size:clamp(2rem,10vw,3.5rem); }
  .big { font-size:clamp(1.4rem,6vw,2.2rem); }
  .medium { font-size:clamp(1rem,4vw,1.3rem); }
  .chain-flow { flex-direction:column; }
  .chain-arrow { transform:rotate(90deg); padding:8px 0; }
  .phase-track { flex-direction:column; gap:10px; align-items:flex-start; }
  .phase-arrow { display:none; }
  .points li { font-size:14px; padding:8px 0; }
  .brand { margin-bottom:16px; }
  .spacer-lg { height:24px; }
  .live-pip { bottom:10px; right:10px; padding:6px 10px; }
  .slide-num { bottom:10px; font-size:10px; }
  .scenario-box { padding:20px 16px; }
}
</style>
</head>
<body>

<a href="present-index.html" class="back-link">← index</a>
<div class="progress" id="progress"></div>
<div class="slide-num"><button class="nav-btn" id="prevBtn" onclick="if(current>1)showSlide(--current)">←</button><span id="slideNum"></span><button class="nav-btn" id="nextBtn" onclick="if(current<total)showSlide(++current)">→</button><a href="present-index.html" class="nav-btn" style="text-decoration:none;">⌂</a></div>

<div class="live-pip" id="livePip">
  <div class="dot"></div>
  <span class="count" id="pipCount">0</span>
  <span class="label">events</span>
</div>

<div class="deck">

  <!-- SLIDE 1: HOOK -->
  <div class="slide glow-bg" id="slide-0">
    <div class="brand fade-up">
      <span class="rh">Red Hat</span>
      <span class="sep">×</span>
      <span class="sap">SAP</span>
    </div>
    <div class="mega center fade-up delay-1">
      One contractor.<br>Three systems.<br><span class="red">Zero visibility.</span>
    </div>
    <div class="spacer"></div>
    <div class="medium center fade-up delay-2" style="max-width:700px;">
      Physical security, IT, and OT don't talk to each other.<br>Attackers do.
    </div>
  </div>

  <!-- SLIDE 2: KILL CHAIN FLOW -->
  <div class="slide glow-bg" id="slide-1">
    <div class="big center fade-up" style="max-width:820px;">
      The attack crosses <span class="red">three silos.</span>
    </div>
    <div class="chain-flow fade-up delay-1">
      <div class="chain-node">
        <span class="node-icon">&#x1FAA7;</span>
        <div class="node-label">Physical / PACS</div>
        <div class="node-desc">Cloned badge.<br>Server room access.</div>
      </div>
      <div class="chain-arrow">&#x2192;</div>
      <div class="chain-node">
        <span class="node-icon">&#x1F4BB;</span>
        <div class="node-label">IT / ERP</div>
        <div class="node-desc">Lateral move.<br>SAP HANA credential.</div>
      </div>
      <div class="chain-arrow">&#x2192;</div>
      <div class="chain-node">
        <span class="node-icon">&#x2699;&#xFE0F;</span>
        <div class="node-label">OT / PLC</div>
        <div class="node-desc">Target reached.<br>Production at risk.</div>
      </div>
    </div>
    <div class="chain-subtitle fade-up delay-2">
      No single vendor sees the full chain. <strong style="color:var(--text);">Red Hat connects them.</strong>
    </div>
  </div>

  <!-- SLIDE 3: THE STACK -->
  <div class="slide glow-bg" id="slide-2">
    <div class="big center fade-up" style="max-width:820px;">
      Three vendors. <span class="red">One enforcement layer.</span>
    </div>
    <ul class="points fade-up delay-1">
      <li>
        <span class="icon">&#x1FAA7;</span>
        <span><strong>AlertEnterprise PACS</strong> detects the badge anomaly</span>
      </li>
      <li>
        <span class="icon">&#x1F4CB;</span>
        <span><strong>SAP GRC</strong> correlates the ERP credential — same contractor</span>
      </li>
      <li>
        <span class="icon">&#x26A1;</span>
        <span><strong>Red Hat Ansible</strong> triggers OT lockdown before the PLC is reached</span>
      </li>
      <li>
        <span class="icon">&#x1F4CA;</span>
        <span><strong>RegScale CCM</strong> provides unified compliance evidence across NERC CIP, IEC 62443, NIST CSF 2.0</span>
      </li>
    </ul>
  </div>

  <!-- SLIDE 4: FIRE THE SCENARIO -->
  <div class="slide" id="slide-3">
    <div class="big center fade-up">Run the <span class="red">kill chain.</span></div>
    <div class="medium center fade-up delay-1" style="margin-top:10px;max-width:600px;">
      Three events. Three phases. One story.
    </div>
    <div class="scenario-box fade-up delay-2">
      <div class="phase-track">
        <div class="phase-item" id="phase-badge">
          <div class="phase-dot" id="dot-badge"></div>
          <span class="phase-label">&#x1FAA7; Badge Anomaly</span>
        </div>
        <div class="phase-arrow">&#x2192;</div>
        <div class="phase-item" id="phase-it">
          <div class="phase-dot" id="dot-it"></div>
          <span class="phase-label">&#x1F4BB; IT Lateral</span>
        </div>
        <div class="phase-arrow">&#x2192;</div>
        <div class="phase-item" id="phase-ot">
          <div class="phase-dot" id="dot-ot"></div>
          <span class="phase-label">&#x2699;&#xFE0F; OT Lockdown</span>
        </div>
      </div>

      <div class="delay-row">
        <span>Phase delay:</span>
        <button class="delay-btn selected" data-delay="3">3s</button>
        <button class="delay-btn" data-delay="5">5s</button>
        <button class="delay-btn" data-delay="10">10s</button>
      </div>

      <button class="fire-btn" id="fireBtn">&#x25B6; Run Kill Chain</button>
      <div class="status-line" id="statusLine">Ready. Select delay and fire.</div>
    </div>
  </div>

  <!-- SLIDE 5: WHY RED HAT WINS -->
  <div class="slide glow-bg" id="slide-4">
    <div class="big center fade-up" style="max-width:820px;">
      Red Hat is the <span class="red">enforcement spine.</span>
    </div>
    <ul class="points fade-up delay-1">
      <li>
        <span class="icon">&#x1F527;</span>
        <span><strong>OpenShift</strong> runs the correlation engine — certified on every cloud and on-prem</span>
      </li>
      <li>
        <span class="icon">&#x26A1;</span>
        <span><strong>Ansible</strong> automates the OT response — playbook-driven, auditable, repeatable</span>
      </li>
      <li>
        <span class="icon">&#x1F5A5;&#xFE0F;</span>
        <span><strong>RHEL</strong> underpins every node from PACS gateway to PLC boundary</span>
      </li>
      <li>
        <span class="icon">&#x1F4CB;</span>
        <span><strong>RegScale + SAP GRC</strong> provide the compliance paper trail automatically</span>
      </li>
    </ul>
  </div>

  <!-- SLIDE 6: CLOSE -->
  <div class="slide glow-bg" id="slide-5">
    <div class="mega center fade-up">
      Badge clone &#x2192; IT lateral &#x2192; <span class="red">OT shutdown.</span>
    </div>
    <div class="spacer"></div>
    <div class="close-sub fade-up delay-1">
      389 seconds in the real world. <span style="color:var(--text);font-weight:700;">9 seconds in this demo.</span>
    </div>
    <div class="accent-rule fade-up delay-2"></div>
    <div class="medium center fade-up delay-3" style="max-width:680px;">
      This is the board-level story.<br>Nobody else tells it end-to-end.
    </div>
  </div>

</div><!-- /deck -->

<script>
const slides = document.querySelectorAll('.slide');
const totalSlides = slides.length;
let current = 0;
let eventCount = 0;

const progressEl = document.getElementById('progress');
const slideNumEl = document.getElementById('slideNum');
const livePip = document.getElementById('livePip');
const pipCountEl = document.getElementById('pipCount');

function goTo(n) {
  if (n < 0 || n >= totalSlides) return;
  slides[current].classList.remove('active');
  current = n;
  slides[current].classList.add('active');
  progressEl.style.width = ((current + 1) / totalSlides * 100) + '%';
  slideNumEl.innerText = (current + 1) + ' / ' + totalSlides;
  livePip.classList.toggle('visible', current >= 1);
}
function next() { goTo(current + 1); }
function prev() { goTo(current - 1); }

// Keyboard nav
document.addEventListener('keydown', e => {
  if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'PageDown') { e.preventDefault(); next(); }
  if (e.key === 'ArrowLeft' || e.key === 'PageUp') { e.preventDefault(); prev(); }
  if (e.key === 'Home') { e.preventDefault(); goTo(0); }
  if (e.key === 'End') { e.preventDefault(); goTo(totalSlides - 1); }
  if (e.key === 'f' || e.key === 'F') {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  }
});

// Touch swipe
let touchStartX = 0, touchStartY = 0;
document.addEventListener('touchstart', e => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, { passive: true });
document.addEventListener('touchend', e => {
  const dx = touchStartX - e.changedTouches[0].clientX;
  const dy = touchStartY - e.changedTouches[0].clientY;
  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 40) {
    if (dx > 0) next(); else prev();
  }
}, { passive: true });

// Click nav (left 20% back, rest forward)
document.addEventListener('click', e => {
  if (e.target.closest('a,button,.back-link')) return;
  if (e.clientX < window.innerWidth * 0.2) prev();
  else next();
});

// Live pip — poll /state every 3s
function fetchState() {
  fetch('/state').then(r => r.json()).then(d => {
    if (d.count !== undefined) { eventCount = d.count; pipCountEl.innerText = eventCount.toLocaleString(); }
  }).catch(() => {});
}
fetchState();
setInterval(fetchState, 3000);

// ── Scenario slide logic ──
let selectedDelay = 3;
let pollInterval = null;
let phasesFound = { badge: false, it: false, ot: false };
let logBaselineCount = 0;

const delayBtns = document.querySelectorAll('.delay-btn');
delayBtns.forEach(btn => {
  btn.addEventListener('click', e => {
    e.stopPropagation();
    delayBtns.forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedDelay = parseInt(btn.dataset.delay, 10);
  });
});

function resetPhases() {
  phasesFound = { badge: false, it: false, ot: false };
  ['badge', 'it', 'ot'].forEach(key => {
    document.getElementById('dot-' + key).classList.remove('fired');
    document.getElementById('phase-' + key).classList.remove('fired');
  });
}

function markPhase(key) {
  if (phasesFound[key]) return;
  phasesFound[key] = true;
  document.getElementById('dot-' + key).classList.add('fired');
  document.getElementById('phase-' + key).classList.add('fired');
}

function allDone() {
  return phasesFound.badge && phasesFound.it && phasesFound.ot;
}

function stopPoll() {
  if (pollInterval) { clearInterval(pollInterval); pollInterval = null; }
}

function startPoll(startTime) {
  const statusLine = document.getElementById('statusLine');
  statusLine.className = 'status-line active-status';
  statusLine.innerText = 'Kill chain running — watching for events...';

  stopPoll();
  pollInterval = setInterval(() => {
    fetch('/log').then(r => r.json()).then(entries => {
      if (!Array.isArray(entries)) return;
      // Only look at entries after we fired (by index or time)
      const relevant = entries.slice(logBaselineCount);
      relevant.forEach(entry => {
        const t = (entry.type || entry.event_type || '');
        if (t.includes('grc.badge_anomaly')) markPhase('badge');
        if (t.includes('grc.it_lateral'))    markPhase('it');
        if (t.includes('grc.ot_lockdown'))   markPhase('ot');
      });
      // Update status
      const fired = ['badge', 'it', 'ot'].filter(k => phasesFound[k]);
      if (allDone()) {
        stopPoll();
        statusLine.className = 'status-line done-status';
        statusLine.innerText = 'All three phases complete. Kill chain demonstrated.';
        document.getElementById('fireBtn').disabled = false;
        document.getElementById('fireBtn').innerText = '\u25B6 Run Kill Chain Again';
      } else if (fired.length > 0) {
        statusLine.innerText = 'Phase ' + fired.length + '/3 fired — ' +
          fired.map(k => ({ badge: 'Badge', it: 'IT', ot: 'OT' }[k])).join(', ');
      }
      // Safety timeout: if we've been polling > (delay * 3 + 10)s, stop
      if (Date.now() - startTime > (selectedDelay * 3 + 15) * 1000) {
        stopPoll();
        if (!allDone()) {
          statusLine.className = 'status-line';
          statusLine.innerText = 'Timed out waiting for events. Check backend.';
          document.getElementById('fireBtn').disabled = false;
          document.getElementById('fireBtn').innerText = '\u25B6 Run Kill Chain';
        }
      }
    }).catch(() => {});
  }, 1500);
}

document.getElementById('fireBtn').addEventListener('click', e => {
  e.stopPropagation();
  const btn = document.getElementById('fireBtn');
  const statusLine = document.getElementById('statusLine');

  btn.disabled = true;
  btn.innerText = 'Firing...';
  resetPhases();
  stopPoll();

  // Snapshot current log length first
  fetch('/log').then(r => r.json()).then(entries => {
    logBaselineCount = Array.isArray(entries) ? entries.length : 0;
    return fetch('/scenario/grc-killchain', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ delay_s: selectedDelay })
    });
  }).then(r => r.json()).then(data => {
    if (data.ok) {
      btn.innerText = 'Running...';
      startPoll(Date.now());
    } else {
      btn.disabled = false;
      btn.innerText = '\u25B6 Run Kill Chain';
      statusLine.className = 'status-line';
      statusLine.innerText = 'Error: scenario endpoint returned failure.';
    }
  }).catch(() => {
    btn.disabled = false;
    btn.innerText = '\u25B6 Run Kill Chain';
    statusLine.className = 'status-line';
    statusLine.innerText = 'Network error — check that the demo server is running.';
  });
});

// Init
goTo(0);
</script>
</body>
</html>
